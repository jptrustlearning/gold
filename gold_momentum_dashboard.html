<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gold Momentum Dashboard | JP Trust Learning</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=Instrument+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#0B0E11;--bg2:#111518;--bg3:#181D22;--card:#151A1F;
  --border:rgba(255,255,255,.06);--border2:rgba(255,255,255,.1);
  --gold:#E8B931;--gold2:#D4A72C;--gold-dim:rgba(232,185,49,.15);--gold-glow:rgba(232,185,49,.3);
  --emerald:#34D399;--emerald-dim:rgba(52,211,153,.15);
  --red:#F87171;--red-dim:rgba(248,113,113,.15);
  --blue:#60A5FA;--blue-dim:rgba(96,165,250,.15);
  --purple:#A78BFA;--purple-dim:rgba(167,139,250,.15);
  --orange:#FB923C;--orange-dim:rgba(251,146,60,.15);
  --cyan:#22D3EE;
  --text:#E8E6E1;--text2:#9CA3AF;--text3:#6B7280;
  --font-h:'DM Serif Display',serif;--font-b:'Instrument Sans',sans-serif;
}
*{margin:0;padding:0;box-sizing:border-box}
html{scroll-behavior:smooth}
body{font-family:var(--font-b);background:var(--bg);color:var(--text);min-height:100vh;overflow-x:hidden;font-size:14px;line-height:1.5}
.container{max-width:1200px;margin:0 auto;padding:24px}

/* Header */
.header{text-align:center;padding:40px 0 30px;position:relative}
.header::before{content:'';position:absolute;top:-40px;left:50%;transform:translateX(-50%);width:700px;height:350px;background:radial-gradient(ellipse,rgba(232,185,49,.08) 0%,rgba(232,185,49,.02) 40%,transparent 70%);pointer-events:none}
.header h1{font-family:var(--font-h);font-size:clamp(2rem,5vw,3.2rem);background:linear-gradient(135deg,#E8B931,#F5D76E,#E8B931,#D4A72C);-webkit-background-clip:text;-webkit-text-fill-color:transparent;letter-spacing:1px;margin-bottom:6px}
.header .sub{font-size:.88rem;color:var(--text2);letter-spacing:3px;text-transform:uppercase;margin-bottom:14px}
.header .period{display:inline-block;padding:7px 24px;background:var(--bg3);border:1px solid var(--border2);border-radius:100px;color:var(--text2);font-size:.82rem}

/* Status */
.status-bar{display:flex;justify-content:center;gap:12px;margin-bottom:24px;flex-wrap:wrap;align-items:center}
.status-indicator{display:flex;align-items:center;gap:8px;font-weight:600;font-size:.82rem;padding:7px 18px;border-radius:50px;background:rgba(255,255,255,.03);border:1px solid var(--border2);transition:.3s}
.status-indicator.loading{color:var(--gold);border-color:var(--gold);background:var(--gold-dim)}
.status-indicator.success{color:var(--emerald);border-color:var(--emerald);background:var(--emerald-dim)}
.status-indicator.error{color:var(--red);border-color:var(--red);background:var(--red-dim)}

/* Hero Score */
.hero{display:flex;justify-content:center;align-items:center;gap:40px;margin-bottom:30px;flex-wrap:wrap}
.hero-score{text-align:center;position:relative}
.hero-score .ring{width:200px;height:200px;position:relative}
.hero-score .ring canvas{position:absolute;top:0;left:0}
.hero-score .center{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);text-align:center}
.hero-score .center .v{font-family:var(--font-h);font-size:3rem;line-height:1}
.hero-score .center .l{font-size:.72rem;color:var(--text3);text-transform:uppercase;letter-spacing:1.5px;margin-top:2px}
.hero-tier{text-align:center}
.hero-tier .tier{font-family:var(--font-h);font-size:2rem;margin-bottom:4px}
.hero-tier .price{font-size:1.4rem;color:var(--gold);font-weight:700;margin-bottom:2px}
.hero-tier .price-label{font-size:.72rem;color:var(--text3);text-transform:uppercase;letter-spacing:1.5px}
.hero-delta{text-align:center;padding:16px 24px;background:var(--card);border:1px solid var(--border2);border-radius:14px}
.hero-delta .v{font-family:var(--font-h);font-size:1.8rem;line-height:1.2}
.hero-delta .l{font-size:.68rem;color:var(--text3);text-transform:uppercase;letter-spacing:1.5px;margin-top:2px}
.hero-delta .sub{font-size:.75rem;color:var(--text3);margin-top:6px}

/* Stats */
.stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(130px,1fr));gap:10px;margin-bottom:24px}
.stat-card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:16px 14px;text-align:center;position:relative;overflow:hidden}
.stat-card::after{content:'';position:absolute;top:0;left:0;right:0;height:2px;opacity:.5}
.stat-card.gold::after{background:var(--gold)}.stat-card.green::after{background:var(--emerald)}.stat-card.red::after{background:var(--red)}.stat-card.blue::after{background:var(--blue)}.stat-card.purple::after{background:var(--purple)}.stat-card.orange::after{background:var(--orange)}.stat-card.cyan::after{background:var(--cyan)}
.stat-card .v{font-family:var(--font-h);font-size:1.6rem;line-height:1.2}
.stat-card .l{font-size:.66rem;color:var(--text3);text-transform:uppercase;letter-spacing:1.2px;margin-top:3px}

/* Sections */
.section{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:20px;margin-bottom:20px}
.section-title{font-family:var(--font-h);font-size:1.15rem;color:var(--text);margin-bottom:16px;display:flex;align-items:center;gap:8px}
.section-title .dot{width:6px;height:6px;border-radius:50%;background:var(--gold)}
.charts-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(340px,1fr));gap:16px;margin-bottom:20px}
.chart-box{height:320px;position:relative}

/* Dimension Bars */
.dim-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:12px;margin-bottom:20px}
.dim-card{background:var(--bg3);border:1px solid var(--border);border-radius:12px;padding:16px 12px;text-align:center;position:relative;overflow:hidden}
.dim-card .score{font-family:var(--font-h);font-size:1.8rem;line-height:1}
.dim-card .max{font-size:.72rem;color:var(--text3);margin-top:2px}
.dim-card .name{font-size:.72rem;color:var(--text2);text-transform:uppercase;letter-spacing:1px;margin-top:8px;font-weight:600}
.dim-card .bar{width:100%;height:4px;background:rgba(255,255,255,.06);border-radius:2px;margin-top:8px;overflow:hidden}
.dim-card .bar .fill{height:100%;border-radius:2px;transition:width .8s ease}

/* Returns table */
.ret-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:8px;margin-bottom:16px}
.ret-card{background:var(--bg3);border:1px solid var(--border);border-radius:10px;padding:14px 10px;text-align:center}
.ret-card .period{font-size:.68rem;color:var(--text3);text-transform:uppercase;letter-spacing:1.2px;margin-bottom:6px;font-weight:600}
.ret-card .val{font-size:1.1rem;font-weight:700}
.ret-card .pctl{font-size:.72rem;color:var(--text3);margin-top:4px}
.pos{color:var(--emerald)}.neg{color:var(--red)}.neu{color:var(--text2)}

/* Info grid */
.info-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:8px}
.info-item{display:flex;justify-content:space-between;padding:10px 14px;background:var(--bg3);border-radius:8px;font-size:.82rem}
.info-item .k{color:var(--text3)}.info-item .v{font-weight:600}

/* Penalty box */
.penalty-box{padding:16px 20px;border-radius:12px;margin-bottom:16px}
.penalty-box.clean{background:var(--emerald-dim);border:1px solid rgba(52,211,153,.2)}
.penalty-box.warn{background:var(--red-dim);border:1px solid rgba(248,113,113,.2)}
.penalty-box .title{font-weight:700;font-size:.82rem;text-transform:uppercase;letter-spacing:1px;margin-bottom:6px}
.penalty-box.clean .title{color:var(--emerald)}
.penalty-box.warn .title{color:var(--red)}
.penalty-box .desc{font-size:.82rem;color:var(--text2)}

/* Tier legend */
.tier-legend{display:flex;flex-wrap:wrap;gap:8px;margin-top:12px;justify-content:center}
.tier-chip{padding:5px 14px;border-radius:7px;font-size:.72rem;font-weight:700;letter-spacing:.4px}

/* Methodology */
.method-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:12px}
.method-card{background:var(--bg3);border:1px solid var(--border);border-radius:10px;padding:16px}
.method-card .title{font-weight:700;font-size:.82rem;color:var(--gold);margin-bottom:8px;text-transform:uppercase;letter-spacing:.8px}
.method-card .body{font-size:.78rem;color:var(--text2);line-height:1.6}

.footer{text-align:center;padding:24px 0;color:var(--text3);font-size:.78rem;border-top:1px solid var(--border);margin-top:30px}
.footer strong{color:var(--gold)}
.hidden{display:none!important}
@keyframes pulse{0%{opacity:.5}50%{opacity:1}100%{opacity:.5}}
.loading-msg{text-align:center;padding:60px;color:var(--text2);font-size:1.1rem;animation:pulse 1.5s infinite}
@keyframes fadeUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
.fade-up{animation:fadeUp .6s ease forwards;opacity:0}
.fade-up:nth-child(1){animation-delay:.05s}.fade-up:nth-child(2){animation-delay:.1s}.fade-up:nth-child(3){animation-delay:.15s}.fade-up:nth-child(4){animation-delay:.2s}.fade-up:nth-child(5){animation-delay:.25s}.fade-up:nth-child(6){animation-delay:.3s}.fade-up:nth-child(7){animation-delay:.35s}

@media(max-width:768px){
  .container{padding:14px 10px}
  .hero{gap:20px}
  .dim-grid{grid-template-columns:repeat(3,1fr)}
  .ret-grid{grid-template-columns:repeat(3,1fr)}
  .chart-box{height:260px}
  .hero-score .ring{width:160px;height:160px}
  .hero-score .center .v{font-size:2.2rem}
}
@media(max-width:480px){
  .dim-grid{grid-template-columns:repeat(2,1fr)}
  .ret-grid{grid-template-columns:repeat(2,1fr)}
}
</style>
</head>
<body>
<div class="container">
  <header class="header">
    <h1>Gold Momentum Score</h1>
    <div class="sub">JP Trust Learning &bull; Rolling Percentile Analysis v2.2</div>
    <div class="period" id="periodLabel">Loading...</div>
  </header>

  <div class="status-bar">
    <div id="status" class="status-indicator loading"><span>‚óè</span> CONNECTING TO GITHUB...</div>
  </div>

  <div id="loadingMsg" class="loading-msg">/// LOADING DATA FROM GITHUB...</div>

  <div id="dashboard" class="hidden">

    <!-- Hero: Big Score + Tier + Delta -->
    <div class="hero" id="heroSection"></div>

    <!-- Stats Grid -->
    <div class="stats-grid" id="statsGrid"></div>

    <!-- Dimension Breakdown -->
    <div class="section fade-up">
      <div class="section-title"><span class="dot"></span>Momentum Dimensions (each /20)</div>
      <div class="dim-grid" id="dimGrid"></div>
    </div>

    <!-- Returns -->
    <div class="section fade-up">
      <div class="section-title"><span class="dot"></span>Return Performance &amp; Rolling Percentile</div>
      <div class="ret-grid" id="retGrid"></div>
    </div>

    <!-- Charts -->
    <div class="charts-grid">
      <div class="section fade-up">
        <div class="section-title"><span class="dot"></span>Dimension Radar</div>
        <div class="chart-box"><canvas id="radarChart"></canvas></div>
      </div>
      <div class="section fade-up">
        <div class="section-title"><span class="dot"></span>Score Breakdown</div>
        <div class="chart-box"><canvas id="barChart"></canvas></div>
      </div>
    </div>

    <!-- Penalty / Warning -->
    <div class="section fade-up">
      <div class="section-title"><span class="dot"></span>Warning Flags &amp; Penalty System</div>
      <div id="penaltySection"></div>
    </div>

    <!-- Technical Details -->
    <div class="section fade-up">
      <div class="section-title"><span class="dot"></span>Technical Details</div>
      <div class="info-grid" id="infoGrid"></div>
    </div>

    <!-- Tier Reference -->
    <div class="section fade-up">
      <div class="section-title"><span class="dot"></span>Momentum Tier Reference</div>
      <div class="tier-legend" id="tierLegend"></div>
    </div>

    <!-- Methodology -->
    <div class="section fade-up">
      <div class="section-title"><span class="dot"></span>Methodology</div>
      <div class="method-grid" id="methodGrid"></div>
    </div>
  </div>

  <footer class="footer">
    <p><strong>JP Trust Learning</strong> &bull; Gold Momentum Dashboard v2.2</p>
    <p style="margin-top:4px">Rolling Percentile Analysis &bull; Single Asset Momentum</p>
  </footer>
</div>

<script>
// ============================================================
// CONFIG
// ============================================================
const CSV_URL = 'https://raw.githubusercontent.com/jptrustlearning/gold/main/output_momentum_gold.csv';

let D = null; // single row of data

// ============================================================
// INIT
// ============================================================
document.addEventListener('DOMContentLoaded', loadData);

async function loadData() {
  const statusEl = document.getElementById('status');
  try {
    const res = await fetch(CSV_URL);
    if (!res.ok) throw new Error('HTTP ' + res.status);
    const text = await res.text();
    const rows = parseCSV(text);
    if (!rows.length) throw new Error('No data rows');
    D = rows[0];

    statusEl.className = 'status-indicator success';
    statusEl.innerHTML = '<span>‚óè</span> GITHUB DATA LOADED ‚Äî GOLD';
    document.getElementById('periodLabel').textContent =
      'As of: ' + D.As_Of_Running + '  ‚Ä¢  BD1: ' + D.Base_Date_1 + '  ‚Ä¢  BD2: ' + D.Base_Date_2;

    document.getElementById('loadingMsg').classList.add('hidden');
    document.getElementById('dashboard').classList.remove('hidden');

    render();
  } catch(e) {
    console.error(e);
    statusEl.className = 'status-indicator error';
    statusEl.innerHTML = '<span>‚óè</span> FAILED TO LOAD ‚Äî ' + e.message;
    document.getElementById('loadingMsg').textContent = 'Error loading data. Check console.';
  }
}

function parseCSV(text) {
  const lines = text.trim().split('\n');
  const headers = csvLine(lines[0]);
  const rows = [];
  for (let i = 1; i < lines.length; i++) {
    const vals = csvLine(lines[i]);
    if (vals.length < headers.length) continue;
    const obj = {};
    headers.forEach((h, idx) => obj[h] = vals[idx]);
    rows.push(obj);
  }
  return rows;
}
function csvLine(line) {
  const r = []; let c = '', q = false;
  for (let i = 0; i < line.length; i++) {
    const ch = line[i];
    if (ch === '"') q = !q;
    else if (ch === ',' && !q) { r.push(c.trim()); c = ''; }
    else c += ch;
  }
  r.push(c.trim()); return r;
}

// ============================================================
// HELPERS
// ============================================================
const f = (key, dec=1) => parseFloat(D[key] || 0).toFixed(dec);
const fi = (key) => parseFloat(D[key] || 0);
const tierColor = t => t.includes('Very Strong') ? 'var(--emerald)' : t.includes('Strong') ? '#34D399' : t.includes('Moderate') ? 'var(--gold)' : t.includes('Neutral') ? 'var(--text2)' : 'var(--red)';
const scoreColor = v => v >= 85 ? 'var(--emerald)' : v >= 75 ? '#34D399' : v >= 60 ? 'var(--gold)' : v >= 45 ? 'var(--text)' : v >= 30 ? 'var(--text2)' : 'var(--red)';
const retColor = v => v >= 0 ? 'var(--emerald)' : 'var(--red)';
const rsiColor = v => v >= 50 && v <= 70 ? 'var(--emerald)' : v > 70 ? 'var(--red)' : 'var(--text2)';
const dimColors = ['#60A5FA','#A78BFA','#34D399','#E8B931','#FB923C'];

// ============================================================
// RENDER ALL
// ============================================================
function render() {
  renderHero();
  renderStats();
  renderDimensions();
  renderReturns();
  renderPenalty();
  renderInfo();
  renderTierLegend();
  renderMethodology();
  renderRadarChart();
  renderBarChart();
}

// ============================================================
// HERO
// ============================================================
function renderHero() {
  const netAvg = fi('Net_Score_Avg');
  const tier = D.Tier;
  const price = fi('Price');
  const delta = fi('Score_Delta');
  const bd1 = fi('Net_Score_BD1');
  const bd2 = fi('Net_Score_BD2');

  document.getElementById('heroSection').innerHTML = `
    <div class="hero-score">
      <div class="ring">
        <canvas id="ringCanvas" width="200" height="200"></canvas>
        <div class="center">
          <div class="v" style="color:${scoreColor(netAvg)}">${netAvg.toFixed(1)}</div>
          <div class="l">Net Score</div>
        </div>
      </div>
    </div>
    <div class="hero-tier">
      <div class="tier" style="color:${tierColor(tier)}">${tier}</div>
      <div class="price">$${price.toLocaleString('en-US',{minimumFractionDigits:1})}</div>
      <div class="price-label">Gold Spot Price</div>
    </div>
    <div class="hero-delta">
      <div class="v" style="color:${delta >= 0 ? 'var(--emerald)' : 'var(--red)'}">
        ${delta >= 0 ? '+' : ''}${delta.toFixed(2)}
      </div>
      <div class="l">Score Delta</div>
      <div class="sub">BD1 ${bd1.toFixed(1)} ‚Üí BD2 ${bd2.toFixed(1)}</div>
    </div>
  `;

  // Draw ring
  setTimeout(() => {
    const canvas = document.getElementById('ringCanvas');
    if (!canvas) return;
    const ctx = canvas.getContext('2d');
    const cx = 100, cy = 100, r = 85, lw = 10;
    const pct = Math.max(0, Math.min(netAvg / 100, 1));
    const startA = -Math.PI / 2;
    const endA = startA + pct * 2 * Math.PI;

    // Background ring
    ctx.beginPath();
    ctx.arc(cx, cy, r, 0, 2 * Math.PI);
    ctx.strokeStyle = 'rgba(255,255,255,.06)';
    ctx.lineWidth = lw;
    ctx.stroke();

    // Score ring
    const grad = ctx.createLinearGradient(0, 0, 200, 200);
    grad.addColorStop(0, '#E8B931');
    grad.addColorStop(0.5, '#34D399');
    grad.addColorStop(1, '#60A5FA');
    ctx.beginPath();
    ctx.arc(cx, cy, r, startA, endA);
    ctx.strokeStyle = grad;
    ctx.lineWidth = lw;
    ctx.lineCap = 'round';
    ctx.stroke();
  }, 100);
}

// ============================================================
// STATS GRID
// ============================================================
function renderStats() {
  const items = [
    { v: f('Gross_Score_Avg'), l: 'Gross Score', cls: 'gold' },
    { v: f('RSI_Value'), l: 'RSI (14d)', cls: fi('RSI_Value') >= 50 && fi('RSI_Value') <= 70 ? 'green' : 'orange' },
    { v: String(D.Golden_Cross).toUpperCase() === 'TRUE' ? '‚úÖ Yes' : '‚ùå No', l: 'Golden Cross', cls: String(D.Golden_Cross).toUpperCase() === 'TRUE' ? 'green' : 'red' },
    { v: f('Volatility_Pct') + '%', l: 'Volatility (Ann.)', cls: fi('Volatility_Pct') <= 30 ? 'green' : fi('Volatility_Pct') <= 50 ? 'orange' : 'red' },
    { v: '$' + fi('MA50').toLocaleString('en-US',{minimumFractionDigits:1}), l: 'MA50', cls: 'blue' },
    { v: '$' + fi('MA200').toLocaleString('en-US',{minimumFractionDigits:1}), l: 'MA200', cls: 'purple' },
    { v: f('Penalty_Total', 0), l: 'Penalty', cls: fi('Penalty_Total') < 0 ? 'red' : 'green' },
  ];

  document.getElementById('statsGrid').innerHTML = items.map(s => `
    <div class="stat-card ${s.cls} fade-up">
      <div class="v" style="color:var(--${s.cls === 'gold' ? 'gold' : s.cls})">${s.v}</div>
      <div class="l">${s.l}</div>
    </div>
  `).join('');
}

// ============================================================
// DIMENSIONS
// ============================================================
function renderDimensions() {
  const dims = [
    { key: 'D1_ReturnRank', name: 'Return Rank', color: dimColors[0] },
    { key: 'D2_VolumeRank', name: 'Volume Rank', color: dimColors[1] },
    { key: 'D3_RSI', name: 'RSI', color: dimColors[2] },
    { key: 'D4_MA', name: 'MA Trend', color: dimColors[3] },
    { key: 'D5_Volatility', name: 'Volatility', color: dimColors[4] },
  ];

  document.getElementById('dimGrid').innerHTML = dims.map(d => {
    const val = fi(d.key);
    const pct = (val / 20 * 100).toFixed(0);
    return `
      <div class="dim-card">
        <div class="score" style="color:${d.color}">${val.toFixed(1)}</div>
        <div class="max">/ 20</div>
        <div class="name">${d.name}</div>
        <div class="bar"><div class="fill" style="width:${pct}%;background:${d.color}"></div></div>
      </div>
    `;
  }).join('');
}

// ============================================================
// RETURNS
// ============================================================
function renderReturns() {
  const periods = [
    { key: 'Ret_1W_Pct', name: '1 Week' },
    { key: 'Ret_1M_Pct', name: '1 Month' },
    { key: 'Ret_3M_Pct', name: '3 Month' },
    { key: 'Ret_6M_Pct', name: '6 Month' },
    { key: 'Ret_1Y_Pct', name: '1 Year' },
  ];

  document.getElementById('retGrid').innerHTML = periods.map(p => {
    const val = fi(p.key);
    return `
      <div class="ret-card">
        <div class="period">${p.name}</div>
        <div class="val" style="color:${retColor(val)}">${val >= 0 ? '+' : ''}${val.toFixed(2)}%</div>
        <div class="pctl">Rolling Pctl</div>
      </div>
    `;
  }).join('');
}

// ============================================================
// PENALTY
// ============================================================
function renderPenalty() {
  const total = fi('Penalty_Total');
  const rev = fi('Penalty_Reversal');
  const dc = fi('Penalty_DeathCross');
  const flags = D.Warning_Flags || '';
  const isClean = total === 0;

  let html = `<div class="penalty-box ${isClean ? 'clean' : 'warn'}">
    <div class="title">${isClean ? '‚úÖ No Warning Flags' : 'üö® Warning Flags Detected'}</div>
    <div class="desc">${isClean
      ? 'No momentum reversal or death cross signals detected. All clear.'
      : `<strong>Total Penalty: ${total}</strong><br>
         Reversal: ${rev} &nbsp;|&nbsp; Death Cross: ${dc}<br>
         ${flags ? 'Flags: ' + flags : ''}`
    }</div>
  </div>`;

  // Penalty breakdown table
  html += `<div class="info-grid">
    <div class="info-item"><span class="k">Momentum Reversal</span><span class="v" style="color:${rev < 0 ? 'var(--red)' : 'var(--emerald)'}">${rev === 0 ? '‚úÖ None' : rev + ' pts'}</span></div>
    <div class="info-item"><span class="k">Death Cross (MA50 &lt; MA200)</span><span class="v" style="color:${dc < 0 ? 'var(--red)' : 'var(--emerald)'}">${dc === 0 ? '‚úÖ None' : dc + ' pts'}</span></div>
    <div class="info-item"><span class="k">Total Penalty (cap -15)</span><span class="v" style="color:${total < 0 ? 'var(--red)' : 'var(--emerald)'}">${total}</span></div>
    <div class="info-item"><span class="k">Gross ‚Üí Net Score</span><span class="v">${f('Gross_Score_Avg')} ‚Üí ${f('Net_Score_Avg')}</span></div>
  </div>`;

  document.getElementById('penaltySection').innerHTML = html;
}

// ============================================================
// TECHNICAL INFO
// ============================================================
function renderInfo() {
  const items = [
    { k: 'Price', v: '$' + fi('Price').toLocaleString('en-US',{minimumFractionDigits:2}) },
    { k: 'MA50', v: '$' + fi('MA50').toLocaleString('en-US',{minimumFractionDigits:2}) },
    { k: 'MA200', v: '$' + fi('MA200').toLocaleString('en-US',{minimumFractionDigits:2}) },
    { k: 'Golden Cross', v: String(D.Golden_Cross).toUpperCase() === 'TRUE' ? '‚úÖ MA50 > MA200' : '‚ùå MA50 < MA200' },
    { k: 'RSI (14-day)', v: fi('RSI_Value').toFixed(1) },
    { k: 'Volatility (Ann.)', v: fi('Volatility_Pct').toFixed(1) + '%' },
    { k: 'WP Return Pctl', v: fi('WP_Return_Pct').toFixed(1) + '%' },
    { k: 'WP Volume Pctl', v: fi('WP_Volume_Pct').toFixed(1) + '%' },
    { k: 'Base Date 1', v: D.Base_Date_1 },
    { k: 'Base Date 2', v: D.Base_Date_2 },
    { k: 'Net Score BD1', v: f('Net_Score_BD1') },
    { k: 'Net Score BD2', v: f('Net_Score_BD2') },
  ];

  document.getElementById('infoGrid').innerHTML = items.map(i => `
    <div class="info-item"><span class="k">${i.k}</span><span class="v">${i.v}</span></div>
  `).join('');
}

// ============================================================
// TIER LEGEND
// ============================================================
function renderTierLegend() {
  const tiers = [
    { name: 'Very Strong ‚Üë‚Üë', range: '‚â•85', bg: 'var(--emerald-dim)', color: 'var(--emerald)', border: 'rgba(52,211,153,.3)' },
    { name: 'Strong ‚Üë', range: '75‚Äì84', bg: 'rgba(52,211,153,.08)', color: '#8BD4B0', border: 'rgba(52,211,153,.2)' },
    { name: 'Moderate ‚Üë', range: '60‚Äì74', bg: 'var(--gold-dim)', color: 'var(--gold)', border: 'rgba(232,185,49,.3)' },
    { name: 'Neutral ‚Üí', range: '45‚Äì59', bg: 'rgba(156,163,175,.08)', color: 'var(--text2)', border: 'rgba(156,163,175,.2)' },
    { name: 'Weak ‚Üì', range: '30‚Äì44', bg: 'var(--orange-dim)', color: 'var(--orange)', border: 'rgba(251,146,60,.2)' },
    { name: 'Very Weak ‚Üì‚Üì', range: '<30', bg: 'var(--red-dim)', color: 'var(--red)', border: 'rgba(248,113,113,.2)' },
  ];

  const currentTier = D.Tier;
  document.getElementById('tierLegend').innerHTML = tiers.map(t => {
    const isCurrent = currentTier.includes(t.name.split(' ')[0]) && currentTier.includes(t.name.split(' ')[1] || '');
    const isActive = D.Tier === t.name;
    return `<div class="tier-chip" style="background:${t.bg};color:${t.color};border:1px solid ${t.border};${isActive ? 'box-shadow:0 0 12px ' + t.border + ';transform:scale(1.1)' : 'opacity:.6'}">
      ${t.name} (${t.range})${isActive ? ' ‚óÄ CURRENT' : ''}
    </div>`;
  }).join('');
}

// ============================================================
// METHODOLOGY
// ============================================================
function renderMethodology() {
  const cards = [
    { title: 'D1: Return Rank', body: 'Rolling percentile of multi-period returns (1W‚Äì1Y) vs past 252 trading days. Weights: 1Y=30%, 6M=25%, 3M=20%, 1M=15%, 1W=10%.' },
    { title: 'D2: Volume Rank', body: 'Rolling percentile of cumulative volume per period. Same weight structure as Return Rank.' },
    { title: 'D3: RSI', body: '14-day Relative Strength Index. Sweet spot (50‚Äì70) = 20pts. Overbought/oversold scores lower.' },
    { title: 'D4: MA Trend', body: 'Price vs MA50 (+7), Price vs MA200 (+7), Golden Cross MA50>MA200 (+6). Max 20pts.' },
    { title: 'D5: Volatility', body: 'Annualized 21-day volatility. Lower = better. ‚â§20%=20pts down to >80%=2pts.' },
    { title: 'Penalty System', body: 'Momentum Reversal: -5 (mild) or -10 (strong). Death Cross: -5. Capped at -15 total.' },
  ];

  document.getElementById('methodGrid').innerHTML = cards.map(c => `
    <div class="method-card">
      <div class="title">${c.title}</div>
      <div class="body">${c.body}</div>
    </div>
  `).join('');
}

// ============================================================
// RADAR CHART
// ============================================================
function renderRadarChart() {
  const ctx = document.getElementById('radarChart').getContext('2d');
  const labels = ['Return Rank','Volume Rank','RSI','MA Trend','Volatility'];
  const values = [fi('D1_ReturnRank'), fi('D2_VolumeRank'), fi('D3_RSI'), fi('D4_MA'), fi('D5_Volatility')];

  new Chart(ctx, {
    type: 'radar',
    data: {
      labels,
      datasets: [{
        label: 'Score',
        data: values,
        backgroundColor: 'rgba(232,185,49,.15)',
        borderColor: '#E8B931',
        borderWidth: 2,
        pointBackgroundColor: dimColors,
        pointBorderColor: dimColors,
        pointRadius: 5,
        pointHoverRadius: 8,
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: { legend: { display: false } },
      scales: {
        r: {
          min: 0, max: 20,
          ticks: { stepSize: 5, color: '#6B7280', backdropColor: 'transparent', font: { size: 10 } },
          grid: { color: 'rgba(255,255,255,.06)' },
          angleLines: { color: 'rgba(255,255,255,.06)' },
          pointLabels: { color: '#9CA3AF', font: { size: 11, family: 'Instrument Sans', weight: '600' } }
        }
      }
    }
  });
}

// ============================================================
// BAR CHART
// ============================================================
function renderBarChart() {
  const ctx = document.getElementById('barChart').getContext('2d');
  const labels = ['Return','Volume','RSI','MA','Volatility'];
  const values = [fi('D1_ReturnRank'), fi('D2_VolumeRank'), fi('D3_RSI'), fi('D4_MA'), fi('D5_Volatility')];
  const penalty = fi('Penalty_Total');

  const allLabels = [...labels];
  const allValues = [...values];
  const allColors = [...dimColors];
  if (penalty !== 0) {
    allLabels.push('Penalty');
    allValues.push(penalty);
    allColors.push('#F87171');
  }

  new Chart(ctx, {
    type: 'bar',
    data: {
      labels: allLabels,
      datasets: [{
        data: allValues,
        backgroundColor: allColors.map(c => c + '33'),
        borderColor: allColors,
        borderWidth: 2,
        borderRadius: 6,
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: { display: false },
        tooltip: {
          backgroundColor: '#1e293b', borderColor: '#E8B931', borderWidth: 1,
          titleColor: '#E8B931', bodyColor: '#E8E6E1', padding: 10,
          callbacks: { label: item => item.raw + (item.dataIndex < 5 ? ' / 20' : ' pts') }
        }
      },
      scales: {
        x: { grid: { display: false }, ticks: { color: '#9CA3AF', font: { size: 11, family: 'Instrument Sans', weight: '600' } } },
        y: { min: penalty < 0 ? penalty - 2 : 0, max: 22, grid: { color: 'rgba(255,255,255,.04)' }, ticks: { color: '#6B7280' } }
      }
    }
  });
}
</script>
</body>
</html>
